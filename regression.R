library(readr)
library(stargazer)
library(corrgram)
library(MASS)
library(pscl)
library(betareg)
library(emmeans)
library(tidyverse)

set.seed(629)

# read data
df <- read_csv("C:/Users/lenovo/PycharmProjects/Research/result_all_in_one/ALL_IN_R_D_APP.csv")
summary(df)
names(df)
dim(df)
str(df)

#FACTORIZE
df$IV_APPLN_R_D <- as.factor(df$IV_APPLN_R_D)
df$IV_APPLN_app <- as.factor(df$IV_APPLN_app)
df$APPLN_AUTH <- as.factor(df$APPLN_AUTH)
df$DV_QUALITY_APPLN_GRANTED <- as.factor(df$DV_QUALITY_APPLN_GRANTED)
df$APPLN_YEAR <- as.factor(df$APPLN_YEAR)

#z-score
df$IV_DIST_3_DIGITS_ZSCORE <- (df$IV_DIST_3_DIGITS - mean(df$IV_DIST_3_DIGITS))/sd(df$IV_DIST_3_DIGITS)

#change order
df <- df %>% dplyr::select("CITING_APPLN_ID", starts_with("DV"), starts_with("IV"), everything())
names(df)


#correlation table
df_corr <- df %>% dplyr::select(-"CITING_APPLN_ID", -"DV_QUALITY_APPLN_GRANTED", -"IV_DIST_3_DIGITS_ZSCORE",
                         -"IV_IS_LARGE_DIST", -"CITING_PATENT_NUMS")
names(df_corr)
df_nums <- df_corr %>% dplyr::select("IV_DIST_3_DIGITS", "IV_APPLN_R_D", "IV_APPLN_app", "DV_QUALITY_PUBLN_CLAIMS", "DV_NOVELTY_AVG_LDA_DIST", "CITING_TOTAL_NUMS", "CITING_NOPATENT_NUMS", "KNOWLEDGE_MATURITY_AVG", "KNOWLEDGE_MATURITY_STD", "TEAM_INVT_SIZE", "TEAM_DIVERSITY", "TEAM_EXPERIENCE_AVG", "TEAM_EXPERIENCE_STD", "TEAM_SUCCESS_AVG", "TEAM_SUCCESS_STD")
df_nums$IV_APPLN_R_D <- as.numeric(df_nums$IV_APPLN_R_D)
df_nums$IV_APPLN_app <- as.numeric(df_nums$IV_APPLN_app)
corr_table <- cor(df_nums)
names(df_nums)

#moderators
moderator_vec <-  as.vector(names(df))[14:24]

##DV_NOVELTY_AVG_LDA_DIST: OLS
#M1 controls
fit_0 <- lm(DV_NOVELTY_AVG_LDA_DIST~APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df)
summary(fit_0)

#M2 IV1(tech distance)+control
fit1_1 <- lm(DV_NOVELTY_AVG_LDA_DIST~IV_DIST_3_DIGITS+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df)
summary(fit1_1)

#M3 IV2(R&D)+control
fit1_2 <- lm(DV_NOVELTY_AVG_LDA_DIST~IV_APPLN_R_D+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df)
summary(fit1_2) 

#M4 IV3(app)+control
fit1_3 <- lm(DV_NOVELTY_AVG_LDA_DIST~IV_APPLN_app+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df)
summary(fit1_3) 

#M5 IV1+IV2+IV1_zscore*IV2+control
fit1_5 <- lm(DV_NOVELTY_AVG_LDA_DIST~IV_DIST_3_DIGITS+IV_APPLN_R_D+IV_DIST_3_DIGITS_ZSCORE*IV_APPLN_R_D+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df)
summary(fit1_5) 

#M6 IV1+IV3+IV1_zscore*IV3+control
fit1_6 <- lm(DV_NOVELTY_AVG_LDA_DIST~IV_DIST_3_DIGITS+IV_APPLN_app+IV_DIST_3_DIGITS_ZSCORE*IV_APPLN_app+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df)
summary(fit1_6) 



##DV_QUALITY_FAMILY_SIZE: Poisson
#M1 controls
fit_0 <- glm(DV_QUALITY_FAMILY_SIZE~APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df, family=poisson())
summary(fit_0)

#M2 IV1(tech distance)+control
fit1_1 <- glm(DV_QUALITY_FAMILY_SIZE~IV_DIST_3_DIGITS+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df, family=poisson())
summary(fit1_1)

#M3 IV2(R&D)+control
fit1_2 <- glm(DV_QUALITY_FAMILY_SIZE~IV_APPLN_R_D+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df, family=poisson())
summary(fit1_2)

#M4 IV3(app)+control
fit1_3 <- glm(DV_QUALITY_FAMILY_SIZE~IV_APPLN_app+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df, family=poisson())
summary(fit1_3) 

#M5 IV1+IV2+IV1_zscore*IV2+control
fit1_5 <- glm(DV_QUALITY_FAMILY_SIZE~IV_DIST_3_DIGITS+IV_APPLN_R_D+IV_DIST_3_DIGITS_ZSCORE*IV_APPLN_R_D+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df, family=poisson())
summary(fit1_5) 

#M6 IV1+IV3+IV1_zscore*IV3+control
fit1_6 <- glm(DV_QUALITY_FAMILY_SIZE~IV_DIST_3_DIGITS+IV_APPLN_app+IV_DIST_3_DIGITS_ZSCORE*IV_APPLN_app+APPLN_AUTH+APPLN_YEAR+CITING_TOTAL_NUMS+CITING_NOPATENT_NUMS+CITING_PATENT_NUMS+KNOWLEDGE_MATURITY_AVG+KNOWLEDGE_MATURITY_STD+TEAM_DIVERSITY+TEAM_EXPERIENCE_AVG+TEAM_EXPERIENCE_STD+TEAM_INVT_SIZE+TEAM_SUCCESS_AVG+TEAM_SUCCESS_STD, data = df, family=poisson())
summary(fit1_6) 
